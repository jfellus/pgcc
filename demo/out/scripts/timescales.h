///////////////////////////////////////////////
// PGCC AUTO-GENERATED SCRIPT IMPLEMENTATION //
///////////////////////////////////////////////

/*
	This file was auto-generated by PGCC.
	You shouldn't edit anything in it.
*/


#ifndef __PG_SCRIPT_timescales_H
#define __PG_SCRIPT_timescales_H

//////////////
// INCLUDES //
//////////////

#include "../utils/sync_semaphores.h"
#include "/home/jfellus/workspace/pg_nav/src/Hog.h"
#include "/home/jfellus/workspace/pg_nav/src/VLAT.h"
#include "/home/jfellus/workspace/pg_nav/src/Camera.h"
#include "/home/jfellus/workspace/pg_nav/src/Codebook.h"


/////////////////////////////////////////
// IMPLEMENTATION OF SCRIPT timescales //
/////////////////////////////////////////

class Script_timescales {
public:
	Avant avant1;
	Avant avant2;
	Dedans dedans1;
	Dedans dedans2;
	Apres apres1;

	SEM_DECL(avant1, dedans1);
	SEM_DECL(avant1, $START_TIMESCALE_1);
	SEM_DECL(avant2, dedans2);
	SEM_DECL(avant2, $START_TIMESCALE_1);


	Script_timescales() {
		avant1.path = "/dev/video0";
		avant2.zob = "t2";
	}

	void init() {
		SEM_INIT(avant1, dedans1);
		SEM_INIT(avant1, $START_TIMESCALE_1);
		avant1.init();
		SEM_INIT(avant2, dedans2);
		SEM_INIT(avant2, $START_TIMESCALE_1);
		avant2.init();
		dedans1.init();
		dedans2.init();
		apres1.init();
	}


/////////////////
// THREADS (3) //
/////////////////

	void process_thread_0() {
		avant1.process();
		SEM_SEND(avant1, dedans1);
		SEM_SEND(avant1, $START_TIMESCALE_1);
	}

	void process_thread_1() {
		avant2.process();
		SEM_SEND(avant2, dedans2);
		SEM_SEND(avant2, $START_TIMESCALE_1);
	}

	void process_thread_2() {
		for (int k=0; k<100; k++) {
			SEM_RECV(avant1, dedans1);
			dedans1.process(avant1);
			SEM_RECV(avant2, dedans2);
			dedans2.process(avant2);
		}
		apres1.process(dedans1, dedans2);
	}

};

#endif // __PG_SCRIPT_timescales_H
